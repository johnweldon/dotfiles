#!/usr/bin/env bash
set -euo pipefail

read -r -d '' AWK <<'EOF' || true
BEGIN { RS = "\1" ; FS = "\t" }
{
           date=$1;
        refname=$2;
           subj=$3
            sha=$4;
           head=$5;

            ln2=split(subj, subja, "\n");
        subject=substr(subja[1],1, 72);

        if (substr(refname, 1, 13) == "refs/remotes/") {
            rest=substr(refname, 14);
            st=index(rest, "/");
            remote=substr(rest, 1, st-1);
            branch=substr(rest, st+1);
        } else {
            remote=" -- ";
            branch=substr(refname, 12);
        }

          reset="\033[0m";

          black="\033[0;30m";
            red="\033[0;31m";
          green="\033[0;32m";
          brown="\033[0;33m";
           blue="\033[0;34m";
         purple="\033[0;35m";
           cyan="\033[0;36m";
      lightgray="\033[0;37m";

       darkgray="\033[1;30m";
       lightred="\033[1;31m";
     lightgreen="\033[1;32m";
         yellow="\033[1;33m";
      lightblue="\033[1;34m";
    lightpurple="\033[1;35m";
      lightcyan="\033[1;36m";
          white="\033[1;37m";


         fmtstr=lightred "%15s" cyan "%s" lightgreen "%-25s" lightcyan " %15s" yellow " %s" reset " %s\n";

        printf fmtstr, remote, head, branch, date, sha, subject;
}
EOF

FOR_EACH_FORMAT="%(committerdate:relative)%09%(refname)%09%(subject)%09%(objectname:short)%09%(HEAD)%01"

git for-each-ref --sort=committerdate --format=$FOR_EACH_FORMAT refs/heads refs/remotes | tr -d '\r\n' | awk "$AWK"
